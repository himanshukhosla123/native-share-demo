<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
  </head>
  <body>
    
    <div class="container">
      <h1>Cross Site Iframe Demo</h1>
  
      <div class="box">
        <h3>Main Site Url (current)</h3>
        <br />
        <input
          type="text"
          name="demo"
          placeholder="enter text to test"
          id="search"
        />
        <button onclick="sendToIframe()">Send to iframe</button>
        <button onclick="getCookies()">Get Cookies of iframe</button>
      </div>
      <div class="box">
        <h3>Iframe Url (naukrigulf)</h3>
        <br />
        <h4>Received Message</h4>
        <p id="received"></p>
        <p id="lastlogin"></p>
        <p id="currentLogin"></p>
        <br />
        <h4>Preview</h4>
        <iframe
          name="otherSite"
          ref="iframe"
          src="https://www.naukrigulf.com/?qhdgsm12=1"
          height="300px"
        ></iframe>
      </div>
    </div>

  <script>
    window.onload = function() {
      window.addEventListener('message', (event) => {
        console.log(event.data);
        if (event.origin != 'https://www.naukrigulf.com') {
          // something from an unknown domain, let's ignore it
          return;
        }

        alert('Received message from iframe');

        document.getElementById('received').innerHTML = event.data;
        formatTime(event.data);
      });
    }

    function formatTime(str) {
      let pairs = str.split(';');
			let allCookies = {};
			for (let i = pairs.length - 1; i >= 0; i--) {
				let pair = pairs[i].split('=');
			}

      if (allCookies.currentLoggedIn) {
        document.getElementById('currentLogin').innerHTML = `<strong>Current Login:</strong> ${new Date(allCookies.currentLoggedIn)}`;
      }

      if (allCookies.previousLoggedIn) {
        document.getElementById('lastlogin').innerHTML = `<strong>Last Login:</strong> ${new Date(allCookies.previousLoggedIn)}`;
      }

    }
    
    function sendToIframe() {
      let customText = document.getElementById('search').value;
			alert('Message sent to iframe');
			window.frames.otherSite.postMessage(customText, 'https://www.naukrigulf.com');
		}

		function getCookies() {
			sendToIframe('cookies');
		}
  </script>
</body>
</html>

